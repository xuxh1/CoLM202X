#include <define.h>

MODULE MOD_BGCTimeVars
#ifdef BGC
! -------------------------------
! Created by Yongjiu Dai, 03/2014
! -------------------------------

use precision
use timemanager
IMPLICIT NONE
SAVE
!------------------------- BGC variables -------------------------------
      REAL(r8), allocatable :: decomp_cpools_vr  (:,:,:)
      REAL(r8), allocatable :: decomp_cpools     (:,:)
      REAL(r8), allocatable :: decomp_k          (:,:,:) ! soil decomposition rate [1/s]
      REAL(r8), allocatable :: ctrunc_vr         (:,:)
      REAL(r8), allocatable :: ctrunc_veg        (:)
      REAL(r8), allocatable :: ctrunc_soil       (:)

      REAL(r8), allocatable :: t_scalar          (:,:)   ! soil decomposition temperature scalars [unitless]
      REAL(r8), allocatable :: w_scalar          (:,:)   ! soil decomposition water scalars [unitless]
      REAL(r8), allocatable :: o_scalar          (:,:)   ! soil decomposition oxygen scalars [unitless]
      REAL(r8), allocatable :: depth_scalar      (:,:)   ! soil decomposition depth scalars [unitless]

! Soil CN diffusion and advection
      REAL(r8), allocatable :: som_adv_coef             (:,:)
      REAL(r8), allocatable :: som_diffus_coef          (:,:)

! Active Layer
      REAL(r8), allocatable :: altmax                   (:)
      REAL(r8), allocatable :: altmax_lastyear          (:)
      INTEGER , allocatable :: altmax_lastyear_indx     (:)

      REAL(r8), allocatable :: totlitc                  (:)
      REAL(r8), allocatable :: totvegc                  (:)
      REAL(r8), allocatable :: totsomc                  (:)
      REAL(r8), allocatable :: totcwdc                  (:)
      REAL(r8), allocatable :: totcolc                  (:)
      REAL(r8), allocatable :: col_begcb                (:)
      REAL(r8), allocatable :: col_endcb                (:)
      REAL(r8), allocatable :: col_vegbegcb             (:)
      REAL(r8), allocatable :: col_vegendcb             (:)
      REAL(r8), allocatable :: col_soilbegcb            (:)
      REAL(r8), allocatable :: col_soilendcb            (:)

      REAL(r8), allocatable :: totlitn                  (:)
      REAL(r8), allocatable :: totvegn                  (:)
      REAL(r8), allocatable :: totsomn                  (:)
      REAL(r8), allocatable :: totcwdn                  (:)
      REAL(r8), allocatable :: totcoln                  (:)
      REAL(r8), allocatable :: col_begnb                (:)
      REAL(r8), allocatable :: col_endnb                (:)
      REAL(r8), allocatable :: col_vegbegnb             (:)
      REAL(r8), allocatable :: col_vegendnb             (:)
      REAL(r8), allocatable :: col_soilbegnb            (:)
      REAL(r8), allocatable :: col_soilendnb            (:)
      REAL(r8), allocatable :: col_sminnbegnb           (:)
      REAL(r8), allocatable :: col_sminnendnb           (:)

      REAL(r8), allocatable :: leafc                    (:)
      REAL(r8), allocatable :: leafc_storage            (:)
      REAL(r8), allocatable :: leafc_xfer               (:)
      REAL(r8), allocatable :: frootc                   (:)
      REAL(r8), allocatable :: frootc_storage           (:)
      REAL(r8), allocatable :: frootc_xfer              (:)
      REAL(r8), allocatable :: livestemc                (:)
      REAL(r8), allocatable :: livestemc_storage        (:)
      REAL(r8), allocatable :: livestemc_xfer           (:)
      REAL(r8), allocatable :: deadstemc                (:)
      REAL(r8), allocatable :: deadstemc_storage        (:)
      REAL(r8), allocatable :: deadstemc_xfer           (:)
      REAL(r8), allocatable :: livecrootc               (:)
      REAL(r8), allocatable :: livecrootc_storage       (:)
      REAL(r8), allocatable :: livecrootc_xfer          (:)
      REAL(r8), allocatable :: deadcrootc               (:)
      REAL(r8), allocatable :: deadcrootc_storage       (:)
      REAL(r8), allocatable :: deadcrootc_xfer          (:)
      REAL(r8), allocatable :: grainc                   (:)
      REAL(r8), allocatable :: grainc_storage           (:)
      REAL(r8), allocatable :: grainc_xfer              (:)
      REAL(r8), allocatable :: xsmrpool                 (:)
      REAL(r8), allocatable :: downreg                  (:)
      REAL(r8), allocatable :: cropprod1c               (:)
      REAL(r8), allocatable :: cropseedc_deficit        (:)

      REAL(r8), allocatable :: leafn                    (:)
      REAL(r8), allocatable :: leafn_storage            (:)
      REAL(r8), allocatable :: leafn_xfer               (:)
      REAL(r8), allocatable :: frootn                   (:)
      REAL(r8), allocatable :: frootn_storage           (:)
      REAL(r8), allocatable :: frootn_xfer              (:)
      REAL(r8), allocatable :: livestemn                (:)
      REAL(r8), allocatable :: livestemn_storage        (:)
      REAL(r8), allocatable :: livestemn_xfer           (:)
      REAL(r8), allocatable :: deadstemn                (:)
      REAL(r8), allocatable :: deadstemn_storage        (:)
      REAL(r8), allocatable :: deadstemn_xfer           (:)
      REAL(r8), allocatable :: livecrootn               (:)
      REAL(r8), allocatable :: livecrootn_storage       (:)
      REAL(r8), allocatable :: livecrootn_xfer          (:)
      REAL(r8), allocatable :: deadcrootn               (:)
      REAL(r8), allocatable :: deadcrootn_storage       (:)
      REAL(r8), allocatable :: deadcrootn_xfer          (:)
      REAL(r8), allocatable :: grainn                   (:)
      REAL(r8), allocatable :: grainn_storage           (:)
      REAL(r8), allocatable :: grainn_xfer              (:)
      REAL(r8), allocatable :: retransn                 (:)

      REAL(r8), allocatable :: decomp_npools_vr         (:,:,:)
      REAL(r8), allocatable :: decomp_npools            (:,:)
      REAL(r8), allocatable :: ntrunc_vr                (:,:)
      REAL(r8), allocatable :: ntrunc_veg               (:)
      REAL(r8), allocatable :: ntrunc_soil              (:)

      REAL(r8), allocatable :: sminn_vr                 (:,:)
      REAL(r8), allocatable :: smin_no3_vr              (:,:)
      REAL(r8), allocatable :: smin_nh4_vr              (:,:)
      REAL(r8), allocatable :: sminn                    (:)
      REAL(r8), allocatable :: ndep                     (:)

#ifdef NITRIF
      REAL(r8), allocatable :: to2_decomp_depth_unsat   (:,:)
      REAL(r8), allocatable :: tconc_o2_unsat           (:,:)
#endif

      REAL(r8), allocatable :: ndep_prof                (:,:)
      REAL(r8), allocatable :: nfixation_prof           (:,:)

      REAL(r8), allocatable :: cn_decomp_pools          (:,:,:) 
      REAL(r8), allocatable :: fpi_vr                   (:,:)
      REAL(r8), allocatable :: fpi                      (:)
      REAL(r8), allocatable :: fpg                      (:)

      REAL(r8), allocatable :: cropf                    (:)
      REAL(r8), allocatable :: lfwt                     (:)
      REAL(r8), allocatable :: fuelc                    (:)
      REAL(r8), allocatable :: fuelc_crop               (:)
      REAL(r8), allocatable :: fsr                      (:)
      REAL(r8), allocatable :: fd                       (:)
      REAL(r8), allocatable :: rootc                    (:)
      REAL(r8), allocatable :: lgdp                     (:)
      REAL(r8), allocatable :: lgdp1                    (:)
      REAL(r8), allocatable :: lpop                     (:)
      REAL(r8), allocatable :: wtlf                     (:)
      REAL(r8), allocatable :: trotr1                   (:)
      REAL(r8), allocatable :: trotr2                   (:)
      REAL(r8), allocatable :: hdm_lf                   (:)
      REAL(r8), allocatable :: lnfm                     (:)
      REAL(r8), allocatable :: baf_crop                 (:)
      REAL(r8), allocatable :: baf_peatf                (:)
      REAL(r8), allocatable :: farea_burned             (:)
      REAL(r8), allocatable :: nfire                    (:)
      REAL(r8), allocatable :: fsat                     (:)
      REAL(r8), allocatable :: prec10                   (:) ! 10-day running mean of total      precipitation [mm/s]
      REAL(r8), allocatable :: prec60                   (:) ! 60-day running mean of total      precipitation [mm/s]
      REAL(r8), allocatable :: prec365                  (:) ! 365-day running mean of tota     l precipitation [mm/s]
      REAL(r8), allocatable :: prec_today               (:) ! today's daily precipitation      [mm/day]
      REAL(r8), allocatable :: prec_daily               (:,:) ! daily total precipitation      [mm/day]
      REAL(r8), allocatable :: wf2                      (:)
      REAL(r8), allocatable :: tsoi17                   (:)
      REAL(r8), allocatable :: rh30                     (:) ! 30-day running mean of relative humidity
      REAL(r8), allocatable :: accumnstep               (:) ! 30-day running mean of relative humidity

      REAL(r8), allocatable :: dayl                     (:)
      REAL(r8), allocatable :: prev_dayl                (:)

!--------------BGC/SASU variables---------------------------
      REAL(r8), allocatable :: decomp0_cpools_vr           (:,:,:)
      REAL(r8), allocatable :: I_met_c_vr_acc              (:,:)
      REAL(r8), allocatable :: I_cel_c_vr_acc              (:,:)
      REAL(r8), allocatable :: I_lig_c_vr_acc              (:,:)
      REAL(r8), allocatable :: I_cwd_c_vr_acc              (:,:)
      REAL(r8), allocatable :: AKX_met_to_soil1_c_vr_acc   (:,:)
      REAL(r8), allocatable :: AKX_cel_to_soil1_c_vr_acc   (:,:)
      REAL(r8), allocatable :: AKX_lig_to_soil2_c_vr_acc   (:,:)
      REAL(r8), allocatable :: AKX_soil1_to_soil2_c_vr_acc (:,:)
      REAL(r8), allocatable :: AKX_cwd_to_cel_c_vr_acc     (:,:)
      REAL(r8), allocatable :: AKX_cwd_to_lig_c_vr_acc     (:,:)
      REAL(r8), allocatable :: AKX_soil1_to_soil3_c_vr_acc (:,:)
      REAL(r8), allocatable :: AKX_soil2_to_soil1_c_vr_acc (:,:)
      REAL(r8), allocatable :: AKX_soil2_to_soil3_c_vr_acc (:,:)
      REAL(r8), allocatable :: AKX_soil3_to_soil1_c_vr_acc (:,:)
      REAL(r8), allocatable :: AKX_met_exit_c_vr_acc       (:,:)
      REAL(r8), allocatable :: AKX_cel_exit_c_vr_acc       (:,:)
      REAL(r8), allocatable :: AKX_lig_exit_c_vr_acc       (:,:)
      REAL(r8), allocatable :: AKX_cwd_exit_c_vr_acc       (:,:)
      REAL(r8), allocatable :: AKX_soil1_exit_c_vr_acc     (:,:)
      REAL(r8), allocatable :: AKX_soil2_exit_c_vr_acc     (:,:)
      REAL(r8), allocatable :: AKX_soil3_exit_c_vr_acc     (:,:)

      REAL(r8), allocatable :: decomp0_npools_vr           (:,:,:)
      REAL(r8), allocatable :: I_met_n_vr_acc              (:,:)
      REAL(r8), allocatable :: I_cel_n_vr_acc              (:,:)
      REAL(r8), allocatable :: I_lig_n_vr_acc              (:,:)
      REAL(r8), allocatable :: I_cwd_n_vr_acc              (:,:)
      REAL(r8), allocatable :: AKX_met_to_soil1_n_vr_acc   (:,:)
      REAL(r8), allocatable :: AKX_cel_to_soil1_n_vr_acc   (:,:)
      REAL(r8), allocatable :: AKX_lig_to_soil2_n_vr_acc   (:,:)
      REAL(r8), allocatable :: AKX_soil1_to_soil2_n_vr_acc (:,:)
      REAL(r8), allocatable :: AKX_cwd_to_cel_n_vr_acc     (:,:)
      REAL(r8), allocatable :: AKX_cwd_to_lig_n_vr_acc     (:,:)
      REAL(r8), allocatable :: AKX_soil1_to_soil3_n_vr_acc (:,:)
      REAL(r8), allocatable :: AKX_soil2_to_soil1_n_vr_acc (:,:)
      REAL(r8), allocatable :: AKX_soil2_to_soil3_n_vr_acc (:,:)
      REAL(r8), allocatable :: AKX_soil3_to_soil1_n_vr_acc (:,:)
      REAL(r8), allocatable :: AKX_met_exit_n_vr_acc       (:,:)
      REAL(r8), allocatable :: AKX_cel_exit_n_vr_acc       (:,:)
      REAL(r8), allocatable :: AKX_lig_exit_n_vr_acc       (:,:)
      REAL(r8), allocatable :: AKX_cwd_exit_n_vr_acc       (:,:)
      REAL(r8), allocatable :: AKX_soil1_exit_n_vr_acc     (:,:)
      REAL(r8), allocatable :: AKX_soil2_exit_n_vr_acc     (:,:)
      REAL(r8), allocatable :: AKX_soil3_exit_n_vr_acc     (:,:)

      REAL(r8), allocatable :: diagVX_c_vr_acc             (:,:,:)
      REAL(r8), allocatable :: upperVX_c_vr_acc            (:,:,:)
      REAL(r8), allocatable :: lowerVX_c_vr_acc            (:,:,:)
      REAL(r8), allocatable :: diagVX_n_vr_acc             (:,:,:)
      REAL(r8), allocatable :: upperVX_n_vr_acc            (:,:,:)
      REAL(r8), allocatable :: lowerVX_n_vr_acc            (:,:,:)
      LOGICAL , allocatable :: skip_balance_check          (:)
#ifdef CROP
      REAL(r8), allocatable :: cphase                   (:) ! crop phase
      REAL(r8), allocatable :: vf          (:)
      REAL(r8), allocatable :: gddplant    (:)
      REAL(r8), allocatable :: gddmaturity (:)
      REAL(r8), allocatable :: hui         (:)
      REAL(r8), allocatable :: huiswheat   (:)
      REAL(r8), allocatable :: pdcorn      (:)  
      REAL(r8), allocatable :: pdswheat    (:)
      REAL(r8), allocatable :: pdwwheat    (:)
      REAL(r8), allocatable :: pdsoybean   (:)
      REAL(r8), allocatable :: pdcotton    (:)
      REAL(r8), allocatable :: pdrice1     (:)
      REAL(r8), allocatable :: pdrice2     (:)
      REAL(r8), allocatable :: pdsugarcane (:)  
      REAL(r8), allocatable :: plantdate   (:)  
      REAL(r8), allocatable :: fertnitro_corn      (:)  
      REAL(r8), allocatable :: fertnitro_swheat    (:)
      REAL(r8), allocatable :: fertnitro_wwheat    (:)
      REAL(r8), allocatable :: fertnitro_soybean   (:)
      REAL(r8), allocatable :: fertnitro_cotton    (:)
      REAL(r8), allocatable :: fertnitro_rice1     (:)
      REAL(r8), allocatable :: fertnitro_rice2     (:)
      REAL(r8), allocatable :: fertnitro_sugarcane (:)  
#endif
      REAL(r8), allocatable :: lag_npp             (:)
!------------------------------------------------------

! PUBLIC MEMBER FUNCTIONS:
      public :: allocate_BGCTimeVars
      public :: deallocate_BGCTimeVars
      public :: READ_BGCTimeVars
      public :: WRITE_BGCTimeVars
#ifdef CLMDEBUG
      public :: check_BGCTimeVars
#endif

! PRIVATE MEMBER FUNCTIONS:


!-----------------------------------------------------------------------

  CONTAINS

!-----------------------------------------------------------------------

  SUBROUTINE allocate_BGCTimeVars 
! --------------------------------------------------------------------
! Allocates memory for CLM 1d [numpatch] variables
! ------------------------------------------------------

  use precision
  USE GlobalVars
  use spmd_task
  use mod_landpatch, only : numpatch
  IMPLICIT NONE


  if (p_is_worker) then

     if (numpatch > 0) then

! bgc variables
        allocate (decomp_cpools_vr             (nl_soil_full,ndecomp_pools,numpatch))
        allocate (decomp_cpools                (ndecomp_pools,numpatch))
        allocate (ctrunc_vr                    (nl_soil,numpatch))
        allocate (ctrunc_veg                   (numpatch))
        allocate (ctrunc_soil                  (numpatch))
        allocate (decomp_k                     (nl_soil_full,ndecomp_pools,numpatch))
   
        allocate (t_scalar                     (nl_soil,numpatch))
        allocate (w_scalar                     (nl_soil,numpatch))
        allocate (o_scalar                     (nl_soil,numpatch))
        allocate (depth_scalar                 (nl_soil,numpatch))

        allocate (som_adv_coef                 (nl_soil_full,numpatch))
        allocate (som_diffus_coef              (nl_soil_full,numpatch))

        allocate (altmax                       (numpatch))
        allocate (altmax_lastyear              (numpatch))
        allocate (altmax_lastyear_indx         (numpatch))

        allocate (totlitc                      (numpatch))
        allocate (totvegc                      (numpatch))
        allocate (totsomc                      (numpatch))
        allocate (totcwdc                      (numpatch))
        allocate (totcolc                      (numpatch))
        allocate (col_begcb                    (numpatch))
        allocate (col_endcb                    (numpatch))
        allocate (col_vegbegcb                 (numpatch))
        allocate (col_vegendcb                 (numpatch))
        allocate (col_soilbegcb                (numpatch))
        allocate (col_soilendcb                (numpatch))

        allocate (totlitn                      (numpatch))
        allocate (totvegn                      (numpatch))
        allocate (totsomn                      (numpatch))
        allocate (totcwdn                      (numpatch))
        allocate (totcoln                      (numpatch))
        allocate (col_begnb                    (numpatch))
        allocate (col_endnb                    (numpatch))
        allocate (col_vegbegnb                 (numpatch))
        allocate (col_vegendnb                 (numpatch))
        allocate (col_soilbegnb                (numpatch))
        allocate (col_soilendnb                (numpatch))
        allocate (col_sminnbegnb               (numpatch))
        allocate (col_sminnendnb               (numpatch))

        allocate (leafc                        (numpatch))
        allocate (leafc_storage                (numpatch))
        allocate (leafc_xfer                   (numpatch))
        allocate (frootc                       (numpatch))
        allocate (frootc_storage               (numpatch))
        allocate (frootc_xfer                  (numpatch))
        allocate (livestemc                    (numpatch))
        allocate (livestemc_storage            (numpatch))
        allocate (livestemc_xfer               (numpatch))
        allocate (deadstemc                    (numpatch))
        allocate (deadstemc_storage            (numpatch))
        allocate (deadstemc_xfer               (numpatch))
        allocate (livecrootc                   (numpatch))
        allocate (livecrootc_storage           (numpatch))
        allocate (livecrootc_xfer              (numpatch))
        allocate (deadcrootc                   (numpatch))
        allocate (deadcrootc_storage           (numpatch))
        allocate (deadcrootc_xfer              (numpatch))
        allocate (grainc                       (numpatch))
        allocate (grainc_storage               (numpatch))
        allocate (grainc_xfer                  (numpatch))
        allocate (xsmrpool                     (numpatch))
        allocate (downreg                      (numpatch))
        allocate (cropprod1c                   (numpatch))
        allocate (cropseedc_deficit            (numpatch))

        allocate (leafn                        (numpatch))
        allocate (leafn_storage                (numpatch))
        allocate (leafn_xfer                   (numpatch))
        allocate (frootn                       (numpatch))
        allocate (frootn_storage               (numpatch))
        allocate (frootn_xfer                  (numpatch))
        allocate (livestemn                    (numpatch))
        allocate (livestemn_storage            (numpatch))
        allocate (livestemn_xfer               (numpatch))
        allocate (deadstemn                    (numpatch))
        allocate (deadstemn_storage            (numpatch))
        allocate (deadstemn_xfer               (numpatch))
        allocate (livecrootn                   (numpatch))
        allocate (livecrootn_storage           (numpatch))
        allocate (livecrootn_xfer              (numpatch))
        allocate (deadcrootn                   (numpatch))
        allocate (deadcrootn_storage           (numpatch))
        allocate (deadcrootn_xfer              (numpatch))
        allocate (grainn                       (numpatch))
        allocate (grainn_storage               (numpatch))
        allocate (grainn_xfer                  (numpatch))
        allocate (retransn                     (numpatch))

        allocate (decomp_npools_vr             (nl_soil_full,ndecomp_pools,numpatch))
        allocate (decomp_npools                (ndecomp_pools,numpatch))
        allocate (ntrunc_vr                    (nl_soil,numpatch))
        allocate (ntrunc_veg                   (numpatch))
        allocate (ntrunc_soil                  (numpatch))
        allocate (sminn_vr                     (nl_soil,numpatch))
        allocate (smin_no3_vr                  (nl_soil,numpatch))
        allocate (smin_nh4_vr                  (nl_soil,numpatch))
        allocate (sminn                        (numpatch))
        allocate (ndep                         (numpatch))
   
#ifdef NITRIF
        allocate (to2_decomp_depth_unsat       (nl_soil,numpatch))
        allocate (tconc_o2_unsat               (nl_soil,numpatch))
#endif

        allocate (ndep_prof                    (nl_soil,numpatch))
        allocate (nfixation_prof               (nl_soil,numpatch))

        allocate (cn_decomp_pools              (nl_soil,ndecomp_pools,numpatch))
        allocate (fpi_vr                       (nl_soil,numpatch))
        allocate (fpi                          (numpatch))
        allocate (fpg                          (numpatch))

        allocate (cropf                        (numpatch))
        allocate (lfwt                         (numpatch))
        allocate (fuelc                        (numpatch))
        allocate (fuelc_crop                   (numpatch))
        allocate (fsr                          (numpatch))
        allocate (fd                           (numpatch))
        allocate (rootc                        (numpatch))
        allocate (lgdp                         (numpatch))
        allocate (lgdp1                        (numpatch))
        allocate (lpop                         (numpatch))
        allocate (wtlf                         (numpatch))
        allocate (trotr1                       (numpatch))
        allocate (trotr2                       (numpatch))
        allocate (hdm_lf                       (numpatch))
        allocate (lnfm                         (numpatch))
        allocate (baf_crop                     (numpatch))
        allocate (baf_peatf                    (numpatch))
        allocate (farea_burned                 (numpatch))
        allocate (nfire                        (numpatch))
        allocate (fsat                         (numpatch))
        allocate (prec10                       (numpatch)) ! 10-day running mean of total      precipitation [mm/s]
        allocate (prec60                       (numpatch)) ! 60-day running mean of total      precipitation [mm/s]
        allocate (prec365                      (numpatch)) ! 365-day running mean of tota     l precipitation [mm/s]
        allocate (prec_today                   (numpatch)) ! today's daily precipitation      [mm/day]
        allocate (prec_daily               (365,numpatch)) ! daily total precipitation      [mm/day]
        allocate (wf2                          (numpatch))
        allocate (tsoi17                       (numpatch))
        allocate (rh30                         (numpatch)) ! 30-day running mean of relative humidity
        allocate (accumnstep                   (numpatch)) ! 30-day running mean of relative humidity

        allocate (dayl                         (numpatch))
        allocate (prev_dayl                    (numpatch))

#ifdef SASU
!---------------------------SASU variables--------------------------------------
        allocate (decomp0_cpools_vr            (nl_soil,ndecomp_pools,numpatch))
        allocate (I_met_c_vr_acc               (nl_soil,numpatch))
        allocate (I_cel_c_vr_acc               (nl_soil,numpatch))
        allocate (I_lig_c_vr_acc               (nl_soil,numpatch))
        allocate (I_cwd_c_vr_acc               (nl_soil,numpatch))
        allocate (AKX_met_to_soil1_c_vr_acc    (nl_soil,numpatch))
        allocate (AKX_cel_to_soil1_c_vr_acc    (nl_soil,numpatch))
        allocate (AKX_lig_to_soil2_c_vr_acc    (nl_soil,numpatch))
        allocate (AKX_soil1_to_soil2_c_vr_acc  (nl_soil,numpatch))
        allocate (AKX_cwd_to_cel_c_vr_acc      (nl_soil,numpatch))
        allocate (AKX_cwd_to_lig_c_vr_acc      (nl_soil,numpatch))
        allocate (AKX_soil1_to_soil3_c_vr_acc  (nl_soil,numpatch))
        allocate (AKX_soil2_to_soil1_c_vr_acc  (nl_soil,numpatch))
        allocate (AKX_soil2_to_soil3_c_vr_acc  (nl_soil,numpatch))
        allocate (AKX_soil3_to_soil1_c_vr_acc  (nl_soil,numpatch))
        allocate (AKX_met_exit_c_vr_acc        (nl_soil,numpatch))
        allocate (AKX_cel_exit_c_vr_acc        (nl_soil,numpatch))
        allocate (AKX_lig_exit_c_vr_acc        (nl_soil,numpatch))
        allocate (AKX_cwd_exit_c_vr_acc        (nl_soil,numpatch))
        allocate (AKX_soil1_exit_c_vr_acc      (nl_soil,numpatch))
        allocate (AKX_soil2_exit_c_vr_acc      (nl_soil,numpatch))
        allocate (AKX_soil3_exit_c_vr_acc      (nl_soil,numpatch))

        allocate (decomp0_npools_vr            (nl_soil,ndecomp_pools,numpatch))
        allocate (I_met_n_vr_acc               (nl_soil,numpatch))
        allocate (I_cel_n_vr_acc               (nl_soil,numpatch))
        allocate (I_lig_n_vr_acc               (nl_soil,numpatch))
        allocate (I_cwd_n_vr_acc               (nl_soil,numpatch))
        allocate (AKX_met_to_soil1_n_vr_acc    (nl_soil,numpatch))
        allocate (AKX_cel_to_soil1_n_vr_acc    (nl_soil,numpatch))
        allocate (AKX_lig_to_soil2_n_vr_acc    (nl_soil,numpatch))
        allocate (AKX_soil1_to_soil2_n_vr_acc  (nl_soil,numpatch))
        allocate (AKX_cwd_to_cel_n_vr_acc      (nl_soil,numpatch))
        allocate (AKX_cwd_to_lig_n_vr_acc      (nl_soil,numpatch))
        allocate (AKX_soil1_to_soil3_n_vr_acc  (nl_soil,numpatch))
        allocate (AKX_soil2_to_soil1_n_vr_acc  (nl_soil,numpatch))
        allocate (AKX_soil2_to_soil3_n_vr_acc  (nl_soil,numpatch))
        allocate (AKX_soil3_to_soil1_n_vr_acc  (nl_soil,numpatch))
        allocate (AKX_met_exit_n_vr_acc        (nl_soil,numpatch))
        allocate (AKX_cel_exit_n_vr_acc        (nl_soil,numpatch))
        allocate (AKX_lig_exit_n_vr_acc        (nl_soil,numpatch))
        allocate (AKX_cwd_exit_n_vr_acc        (nl_soil,numpatch))
        allocate (AKX_soil1_exit_n_vr_acc      (nl_soil,numpatch))
        allocate (AKX_soil2_exit_n_vr_acc      (nl_soil,numpatch))
        allocate (AKX_soil3_exit_n_vr_acc      (nl_soil,numpatch))

        allocate (diagVX_c_vr_acc              (nl_soil,ndecomp_pools,numpatch))
        allocate (upperVX_c_vr_acc             (nl_soil,ndecomp_pools,numpatch))
        allocate (lowerVX_c_vr_acc             (nl_soil,ndecomp_pools,numpatch))
        allocate (diagVX_n_vr_acc              (nl_soil,ndecomp_pools,numpatch))
        allocate (upperVX_n_vr_acc             (nl_soil,ndecomp_pools,numpatch))
        allocate (lowerVX_n_vr_acc             (nl_soil,ndecomp_pools,numpatch))

!---------------------------------------------------------------------------
#endif
        allocate (skip_balance_check           (numpatch))

#ifdef CROP
        allocate (cphase                       (numpatch)) ! 30-day running mean of relative humidity
        allocate (vf                    (numpatch))
        allocate (gddmaturity           (numpatch))
        allocate (gddplant              (numpatch))
        allocate (hui                   (numpatch))
        allocate (huiswheat             (numpatch))
        allocate (pdcorn                (numpatch))  
        allocate (pdswheat              (numpatch))
        allocate (pdwwheat              (numpatch))
        allocate (pdsoybean             (numpatch))
        allocate (pdcotton              (numpatch))
        allocate (pdrice1               (numpatch))
        allocate (pdrice2               (numpatch))
        allocate (plantdate             (numpatch))
        allocate (pdsugarcane           (numpatch))  
        allocate (fertnitro_corn        (numpatch))  
        allocate (fertnitro_swheat      (numpatch))
        allocate (fertnitro_wwheat      (numpatch))
        allocate (fertnitro_soybean     (numpatch))
        allocate (fertnitro_cotton      (numpatch))
        allocate (fertnitro_rice1       (numpatch))
        allocate (fertnitro_rice2       (numpatch))
        allocate (fertnitro_sugarcane   (numpatch))  
#endif
        allocate (lag_npp               (numpatch))
     end if
  end if


  END SUBROUTINE allocate_BGCTimeVars


  SUBROUTINE deallocate_BGCTimeVars ()

     use spmd_task
     use mod_landpatch, only : numpatch
     implicit none

     ! --------------------------------------------------
     ! Deallocates memory for CLM 1d [numpatch] variables
     ! --------------------------------------------------

     if (p_is_worker) then
        
        if (numpatch > 0) then

! bgc variables
           deallocate (decomp_cpools_vr             )
           deallocate (decomp_cpools                )
           deallocate (ctrunc_vr                    )
           deallocate (ctrunc_veg                   )
           deallocate (ctrunc_soil                  )
           deallocate (decomp_k                     )
   
           deallocate (t_scalar                     )
           deallocate (w_scalar                     )
           deallocate (o_scalar                     )
           deallocate (depth_scalar                 )

           deallocate (som_adv_coef                 )
           deallocate (som_diffus_coef              )

           deallocate (altmax                       )
           deallocate (altmax_lastyear              )
           deallocate (altmax_lastyear_indx         )

           deallocate (totlitc                      )
           deallocate (totvegc                      )
           deallocate (totsomc                      )
           deallocate (totcwdc                      )
           deallocate (totcolc                      )
           deallocate (col_begcb                    )
           deallocate (col_endcb                    )
           deallocate (col_vegbegcb                 )
           deallocate (col_vegendcb                 )
           deallocate (col_soilbegcb                )
           deallocate (col_soilendcb                )

           deallocate (totlitn                      )
           deallocate (totvegn                      )
           deallocate (totsomn                      )
           deallocate (totcwdn                      )
           deallocate (totcoln                      )
           deallocate (col_begnb                    )
           deallocate (col_endnb                    )
           deallocate (col_vegbegnb                 )
           deallocate (col_vegendnb                 )
           deallocate (col_soilbegnb                )
           deallocate (col_soilendnb                )
           deallocate (col_sminnbegnb               )
           deallocate (col_sminnendnb               )

           deallocate (leafc                        )
           deallocate (leafc_storage                )
           deallocate (leafc_xfer                   )
           deallocate (frootc                       )
           deallocate (frootc_storage               )
           deallocate (frootc_xfer                  )
           deallocate (livestemc                    )
           deallocate (livestemc_storage            )
           deallocate (livestemc_xfer               )
           deallocate (deadstemc                    )
           deallocate (deadstemc_storage            )
           deallocate (deadstemc_xfer               )
           deallocate (livecrootc                   )
           deallocate (livecrootc_storage           )
           deallocate (livecrootc_xfer              )
           deallocate (deadcrootc                   )
           deallocate (deadcrootc_storage           )
           deallocate (deadcrootc_xfer              )
           deallocate (grainc                       )
           deallocate (grainc_storage               )
           deallocate (grainc_xfer                  )
           deallocate (xsmrpool                     )
           deallocate (downreg                      )
           deallocate (cropprod1c                   )
           deallocate (cropseedc_deficit            )

           deallocate (leafn                        )
           deallocate (leafn_storage                )
           deallocate (leafn_xfer                   )
           deallocate (frootn                       )
           deallocate (frootn_storage               )
           deallocate (frootn_xfer                  )
           deallocate (livestemn                    )
           deallocate (livestemn_storage            )
           deallocate (livestemn_xfer               )
           deallocate (deadstemn                    )
           deallocate (deadstemn_storage            )
           deallocate (deadstemn_xfer               )
           deallocate (livecrootn                   )
           deallocate (livecrootn_storage           )
           deallocate (livecrootn_xfer              )
           deallocate (deadcrootn                   )
           deallocate (deadcrootn_storage           )
           deallocate (deadcrootn_xfer              )
           deallocate (grainn                       )
           deallocate (grainn_storage               )
           deallocate (grainn_xfer                  )
           deallocate (retransn                     )

           deallocate (decomp_npools_vr             )
           deallocate (decomp_npools                )
           deallocate (ntrunc_vr                    )
           deallocate (ntrunc_veg                   )
           deallocate (ntrunc_soil                  )
           deallocate (sminn_vr                     )
           deallocate (smin_no3_vr                  )
           deallocate (smin_nh4_vr                  )
           deallocate (sminn                        )
           deallocate (ndep                         )
   
#ifdef NITRIF
           deallocate (to2_decomp_depth_unsat       )
           deallocate (tconc_o2_unsat               )
#endif

           deallocate (ndep_prof                    )
           deallocate (nfixation_prof               )

           deallocate (cn_decomp_pools              )
           deallocate (fpi_vr                       )
           deallocate (fpi                          )
           deallocate (fpg                          )

           deallocate (cropf                        )
           deallocate (lfwt                         )
           deallocate (fuelc                        )
           deallocate (fuelc_crop                   )
           deallocate (fsr                          )
           deallocate (fd                           )
           deallocate (rootc                        )
           deallocate (lgdp                         )
           deallocate (lgdp1                        )
           deallocate (lpop                         )
           deallocate (wtlf                         )
           deallocate (trotr1                       )
           deallocate (trotr2                       )
           deallocate (hdm_lf                       )
           deallocate (lnfm                         )
           deallocate (baf_crop                     )
           deallocate (baf_peatf                    )
           deallocate (farea_burned                 )
           deallocate (nfire                        )
           deallocate (fsat                         )
           deallocate (prec10                       )
           deallocate (prec60                       )
           deallocate (prec365                      )
           deallocate (prec_today                   )
           deallocate (prec_daily                   )
           deallocate (wf2                          )
           deallocate (tsoi17                       )
           deallocate (rh30                         )
           deallocate (accumnstep                   )

           deallocate (dayl                         )
           deallocate (prev_dayl                    )

#ifdef SASU
!---------------------------SASU variables--------------------------------------
           deallocate (decomp0_cpools_vr            )
           deallocate (I_met_c_vr_acc               )
           deallocate (I_cel_c_vr_acc               )
           deallocate (I_lig_c_vr_acc               )
           deallocate (I_cwd_c_vr_acc               )
           deallocate (AKX_met_to_soil1_c_vr_acc    )
           deallocate (AKX_cel_to_soil1_c_vr_acc    )
           deallocate (AKX_lig_to_soil2_c_vr_acc    )
           deallocate (AKX_soil1_to_soil2_c_vr_acc  )
           deallocate (AKX_cwd_to_cel_c_vr_acc      )
           deallocate (AKX_cwd_to_lig_c_vr_acc      )
           deallocate (AKX_soil1_to_soil3_c_vr_acc  )
           deallocate (AKX_soil2_to_soil1_c_vr_acc  )
           deallocate (AKX_soil2_to_soil3_c_vr_acc  )
           deallocate (AKX_soil3_to_soil1_c_vr_acc  )
           deallocate (AKX_met_exit_c_vr_acc        )
           deallocate (AKX_cel_exit_c_vr_acc        )
           deallocate (AKX_lig_exit_c_vr_acc        )
           deallocate (AKX_cwd_exit_c_vr_acc        )
           deallocate (AKX_soil1_exit_c_vr_acc      )
           deallocate (AKX_soil2_exit_c_vr_acc      )
           deallocate (AKX_soil3_exit_c_vr_acc      )

           deallocate (decomp0_npools_vr            )
           deallocate (I_met_n_vr_acc               )
           deallocate (I_cel_n_vr_acc               )
           deallocate (I_lig_n_vr_acc               )
           deallocate (I_cwd_n_vr_acc               )
           deallocate (AKX_met_to_soil1_n_vr_acc    )
           deallocate (AKX_cel_to_soil1_n_vr_acc    )
           deallocate (AKX_lig_to_soil2_n_vr_acc    )
           deallocate (AKX_soil1_to_soil2_n_vr_acc  )
           deallocate (AKX_cwd_to_cel_n_vr_acc      )
           deallocate (AKX_cwd_to_lig_n_vr_acc      )
           deallocate (AKX_soil1_to_soil3_n_vr_acc  )
           deallocate (AKX_soil2_to_soil1_n_vr_acc  )
           deallocate (AKX_soil2_to_soil3_n_vr_acc  )
           deallocate (AKX_soil3_to_soil1_n_vr_acc  )
           deallocate (AKX_met_exit_n_vr_acc        )
           deallocate (AKX_cel_exit_n_vr_acc        )
           deallocate (AKX_lig_exit_n_vr_acc        )
           deallocate (AKX_cwd_exit_n_vr_acc        )
           deallocate (AKX_soil1_exit_n_vr_acc      )
           deallocate (AKX_soil2_exit_n_vr_acc      )
           deallocate (AKX_soil3_exit_n_vr_acc      )

           deallocate (diagVX_c_vr_acc              )
           deallocate (upperVX_c_vr_acc             )
           deallocate (lowerVX_c_vr_acc             )
           deallocate (diagVX_n_vr_acc              )
           deallocate (upperVX_n_vr_acc             )
           deallocate (lowerVX_n_vr_acc             )

!---------------------------------------------------------------------------
#endif
           deallocate (skip_balance_check           )
#ifdef CROP
           deallocate (cphase                       )
           deallocate (vf         )
           deallocate (gddplant   )
           deallocate (gddmaturity)
           deallocate (hui        )
           deallocate (huiswheat  )
           deallocate (pdcorn     )
           deallocate (pdswheat   )
           deallocate (pdwwheat   )
           deallocate (pdsoybean  )
           deallocate (pdcotton   )
           deallocate (pdrice1    )
           deallocate (pdrice2    )
           deallocate (plantdate  )
           deallocate (pdsugarcane)
           deallocate (fertnitro_corn     )
           deallocate (fertnitro_swheat   )
           deallocate (fertnitro_wwheat   )
           deallocate (fertnitro_soybean  )
           deallocate (fertnitro_cotton   )
           deallocate (fertnitro_rice1    )
           deallocate (fertnitro_rice2    )
           deallocate (fertnitro_sugarcane)
#endif
           deallocate (lag_npp    )
        end if
     end if

  END SUBROUTINE deallocate_BGCTimeVars


  !---------------------------------------
  SUBROUTINE WRITE_BGCTimeVars (file_restart)

     !=======================================================================
     ! Original version: Yongjiu Dai, September 15, 1999, 03/2014
     !=======================================================================

     use mod_namelist, only : DEF_REST_COMPRESS_LEVEL 
     USE mod_landpatch
     use ncio_vector
     USE GlobalVars
     IMPLICIT NONE

     character(LEN=*), intent(in) :: file_restart
     
     ! Local variables
     integer :: compress

     compress = DEF_REST_COMPRESS_LEVEL 

     call ncio_create_file_vector (file_restart, landpatch)
     CALL ncio_define_dimension_vector (file_restart, landpatch, 'patch')
     
     CALL ncio_define_dimension_vector (file_restart, landpatch, 'soil',     nl_soil)
     CALL ncio_define_dimension_vector (file_restart, landpatch, 'ndecomp_pools', ndecomp_pools)
     CALL ncio_define_dimension_vector (file_restart, landpatch, 'doy' , 365)

! bgc variables
     call ncio_write_vector (file_restart, 'totlitc              ', 'patch', landpatch, totlitc              )
     call ncio_write_vector (file_restart, 'totvegc              ', 'patch', landpatch, totvegc              )
     call ncio_write_vector (file_restart, 'totsomc              ', 'patch', landpatch, totsomc              )
     call ncio_write_vector (file_restart, 'totcwdc              ', 'patch', landpatch, totcwdc              )
     call ncio_write_vector (file_restart, 'totcolc              ', 'patch', landpatch, totcolc              )
     call ncio_write_vector (file_restart, 'totlitn              ', 'patch', landpatch, totlitn              )
     call ncio_write_vector (file_restart, 'totvegn              ', 'patch', landpatch, totvegn              )
     call ncio_write_vector (file_restart, 'totsomn              ', 'patch', landpatch, totsomn              )
     call ncio_write_vector (file_restart, 'totcwdn              ', 'patch', landpatch, totcwdn              )
     call ncio_write_vector (file_restart, 'totcoln              ', 'patch', landpatch, totcoln              )
       
     call ncio_write_vector (file_restart, 'sminn                ', 'patch', landpatch, sminn                )
     call ncio_write_vector (file_restart, 'ndep                 ', 'patch', landpatch, ndep                 )

     call ncio_write_vector (file_restart, 'decomp_cpools_vr     ', 'soil'  ,   nl_soil, 'ndecomp_pools', ndecomp_pools, &
                                                                    'patch', landpatch,     decomp_cpools_vr(1:nl_soil,:,:))
     call ncio_write_vector (file_restart, 'ctrunc_vr            ', 'soil'  ,   nl_soil, 'patch', landpatch, ctrunc_vr(1:nl_soil,:))

     call ncio_write_vector (file_restart, 'altmax               ', 'patch', landpatch, altmax               )
     call ncio_write_vector (file_restart, 'altmax_lastyear      ', 'patch', landpatch, altmax_lastyear      )
     call ncio_write_vector (file_restart, 'altmax_lastyear_indx ', 'patch', landpatch, altmax_lastyear_indx )

     call ncio_write_vector (file_restart, 'decomp_npools_vr     ', 'soil'  ,   nl_soil, 'ndecomp_pools', ndecomp_pools, &
                                                                    'patch', landpatch,     decomp_npools_vr(1:nl_soil,:,:))
     call ncio_write_vector (file_restart, 'ntrunc_vr            ', 'soil'  ,   nl_soil, 'patch', landpatch, ntrunc_vr(1:nl_soil,:))
     call ncio_write_vector (file_restart, 'sminn_vr             ', 'soil'  ,   nl_soil, 'patch', landpatch, sminn_vr    )
     call ncio_write_vector (file_restart, 'smin_no3_vr          ', 'soil'  ,   nl_soil, 'patch', landpatch, smin_no3_vr )
     call ncio_write_vector (file_restart, 'smin_nh4_vr          ', 'soil'  ,   nl_soil, 'patch', landpatch, smin_nh4_vr )
#ifdef NITRIF
     call ncio_write_vector (file_restart, 'tCONC_O2_UNSAT       ', 'soil'  ,   nl_soil, 'patch', landpatch, tconc_o2_unsat)
     call ncio_write_vector (file_restart, 'tO2_DECOMP_DEPTH_UNSAT','soil'  ,   nl_soil, 'patch', landpatch, to2_decomp_depth_unsat)
#endif

     call ncio_write_vector (file_restart, 'prec10               ', 'patch', landpatch, prec10               )
     call ncio_write_vector (file_restart, 'prec60               ', 'patch', landpatch, prec60               )
     call ncio_write_vector (file_restart, 'prec365              ', 'patch', landpatch, prec365              )
     call ncio_write_vector (file_restart, 'prec_today           ', 'patch', landpatch, prec_today           )
     call ncio_write_vector (file_restart, 'prec_daily           ', 'doy'   ,       365, 'patch', landpatch, prec_daily  )
     call ncio_write_vector (file_restart, 'tsoi17               ', 'patch', landpatch, tsoi17               )
     call ncio_write_vector (file_restart, 'rh30                 ', 'patch', landpatch, rh30                 )
     call ncio_write_vector (file_restart, 'accumnstep           ', 'patch', landpatch, accumnstep           )

#ifdef SASU
!---------------SASU variables-----------------------
     call ncio_write_vector (file_restart, 'decomp0_cpools_vr            ', 'soil'  ,   nl_soil, 'ndecomp_pools', ndecomp_pools, &
                                                                            'patch', landpatch, decomp0_cpools_vr            )
     call ncio_write_vector (file_restart, 'I_met_c_vr_acc               ', 'soil'  ,   nl_soil, 'patch', landpatch, I_met_c_vr_acc               )
     call ncio_write_vector (file_restart, 'I_cel_c_vr_acc               ', 'soil'  ,   nl_soil, 'patch', landpatch, I_cel_c_vr_acc               )
     call ncio_write_vector (file_restart, 'I_lig_c_vr_acc               ', 'soil'  ,   nl_soil, 'patch', landpatch, I_lig_c_vr_acc               )
     call ncio_write_vector (file_restart, 'I_cwd_c_vr_acc               ', 'soil'  ,   nl_soil, 'patch', landpatch, I_cwd_c_vr_acc               )
     call ncio_write_vector (file_restart, 'AKX_met_to_soil1_c_vr_acc    ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_met_to_soil1_c_vr_acc    )
     call ncio_write_vector (file_restart, 'AKX_cel_to_soil1_c_vr_acc    ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_cel_to_soil1_c_vr_acc    )
     call ncio_write_vector (file_restart, 'AKX_lig_to_soil2_c_vr_acc    ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_lig_to_soil2_c_vr_acc    )
     call ncio_write_vector (file_restart, 'AKX_soil1_to_soil2_c_vr_acc  ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil1_to_soil2_c_vr_acc  )
     call ncio_write_vector (file_restart, 'AKX_cwd_to_cel_c_vr_acc      ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_cwd_to_cel_c_vr_acc      )
     call ncio_write_vector (file_restart, 'AKX_cwd_to_lig_c_vr_acc      ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_cwd_to_lig_c_vr_acc      )
     call ncio_write_vector (file_restart, 'AKX_soil1_to_soil3_c_vr_acc  ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil1_to_soil3_c_vr_acc  )
     call ncio_write_vector (file_restart, 'AKX_soil2_to_soil1_c_vr_acc  ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil2_to_soil1_c_vr_acc  )
     call ncio_write_vector (file_restart, 'AKX_soil2_to_soil3_c_vr_acc  ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil2_to_soil3_c_vr_acc  )
     call ncio_write_vector (file_restart, 'AKX_soil3_to_soil1_c_vr_acc  ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil3_to_soil1_c_vr_acc  )
     call ncio_write_vector (file_restart, 'AKX_met_exit_c_vr_acc        ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_met_exit_c_vr_acc        )
     call ncio_write_vector (file_restart, 'AKX_cel_exit_c_vr_acc        ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_cel_exit_c_vr_acc        )
     call ncio_write_vector (file_restart, 'AKX_lig_exit_c_vr_acc        ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_lig_exit_c_vr_acc        )
     call ncio_write_vector (file_restart, 'AKX_cwd_exit_c_vr_acc        ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_cwd_exit_c_vr_acc        )
     call ncio_write_vector (file_restart, 'AKX_soil1_exit_c_vr_acc      ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil1_exit_c_vr_acc      )
     call ncio_write_vector (file_restart, 'AKX_soil2_exit_c_vr_acc      ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil2_exit_c_vr_acc      )
     call ncio_write_vector (file_restart, 'AKX_soil3_exit_c_vr_acc      ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil3_exit_c_vr_acc      )

     call ncio_write_vector (file_restart, 'decomp0_npools_vr            ', 'soil'  ,   nl_soil, 'ndecomp_pools', ndecomp_pools, &
                                                                            'patch', landpatch, decomp0_npools_vr            )
     call ncio_write_vector (file_restart, 'I_met_n_vr_acc               ', 'soil'  ,   nl_soil, 'patch', landpatch, I_met_n_vr_acc               )
     call ncio_write_vector (file_restart, 'I_cel_n_vr_acc               ', 'soil'  ,   nl_soil, 'patch', landpatch, I_cel_n_vr_acc               )
     call ncio_write_vector (file_restart, 'I_lig_n_vr_acc               ', 'soil'  ,   nl_soil, 'patch', landpatch, I_lig_n_vr_acc               )
     call ncio_write_vector (file_restart, 'I_cwd_n_vr_acc               ', 'soil'  ,   nl_soil, 'patch', landpatch, I_cwd_n_vr_acc               )
     call ncio_write_vector (file_restart, 'AKX_met_to_soil1_n_vr_acc    ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_met_to_soil1_n_vr_acc    )
     call ncio_write_vector (file_restart, 'AKX_cel_to_soil1_n_vr_acc    ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_cel_to_soil1_n_vr_acc    )
     call ncio_write_vector (file_restart, 'AKX_lig_to_soil2_n_vr_acc    ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_lig_to_soil2_n_vr_acc    )
     call ncio_write_vector (file_restart, 'AKX_soil1_to_soil2_n_vr_acc  ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil1_to_soil2_n_vr_acc  )
     call ncio_write_vector (file_restart, 'AKX_cwd_to_cel_n_vr_acc      ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_cwd_to_cel_n_vr_acc      )
     call ncio_write_vector (file_restart, 'AKX_cwd_to_lig_n_vr_acc      ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_cwd_to_lig_n_vr_acc      )
     call ncio_write_vector (file_restart, 'AKX_soil1_to_soil3_n_vr_acc  ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil1_to_soil3_n_vr_acc  )
     call ncio_write_vector (file_restart, 'AKX_soil2_to_soil1_n_vr_acc  ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil2_to_soil1_n_vr_acc  )
     call ncio_write_vector (file_restart, 'AKX_soil2_to_soil3_n_vr_acc  ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil2_to_soil3_n_vr_acc  )
     call ncio_write_vector (file_restart, 'AKX_soil3_to_soil1_n_vr_acc  ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil3_to_soil1_n_vr_acc  )
     call ncio_write_vector (file_restart, 'AKX_met_exit_n_vr_acc        ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_met_exit_n_vr_acc        )
     call ncio_write_vector (file_restart, 'AKX_cel_exit_n_vr_acc        ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_cel_exit_n_vr_acc        )
     call ncio_write_vector (file_restart, 'AKX_lig_exit_n_vr_acc        ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_lig_exit_n_vr_acc        )
     call ncio_write_vector (file_restart, 'AKX_cwd_exit_n_vr_acc        ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_cwd_exit_n_vr_acc        )
     call ncio_write_vector (file_restart, 'AKX_soil1_exit_n_vr_acc      ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil1_exit_n_vr_acc      )
     call ncio_write_vector (file_restart, 'AKX_soil2_exit_n_vr_acc      ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil2_exit_n_vr_acc      )
     call ncio_write_vector (file_restart, 'AKX_soil3_exit_n_vr_acc      ', 'soil'  ,   nl_soil, 'patch', landpatch, AKX_soil3_exit_n_vr_acc      )

     call ncio_write_vector (file_restart, 'diagVX_c_vr_acc              ', 'soil'  ,   nl_soil, 'ndecomp_pools', ndecomp_pools, &
                                                                            'patch', landpatch, diagVX_c_vr_acc              )
     call ncio_write_vector (file_restart, 'upperVX_c_vr_acc             ', 'soil'  ,   nl_soil, 'ndecomp_pools', ndecomp_pools, &
                                                                            'patch', landpatch, upperVX_c_vr_acc             )
     call ncio_write_vector (file_restart, 'lowerVX_c_vr_acc             ', 'soil'  ,   nl_soil, 'ndecomp_pools', ndecomp_pools, &
                                                                            'patch', landpatch, lowerVX_c_vr_acc             )
     call ncio_write_vector (file_restart, 'diagVX_n_vr_acc              ', 'soil'  ,   nl_soil, 'ndecomp_pools', ndecomp_pools, &
                                                                            'patch', landpatch, diagVX_n_vr_acc              )
     call ncio_write_vector (file_restart, 'upperVX_n_vr_acc             ', 'soil'  ,   nl_soil, 'ndecomp_pools', ndecomp_pools, &
                                                                            'patch', landpatch, upperVX_n_vr_acc             )
     call ncio_write_vector (file_restart, 'lowerVX_n_vr_acc             ', 'soil'  ,   nl_soil, 'ndecomp_pools', ndecomp_pools, &
                                                                            'patch', landpatch, lowerVX_n_vr_acc             )

!----------------------------------------------------
#endif
     call ncio_write_vector (file_restart, 'skip_balance_check           ', 'patch', landpatch, skip_balance_check           )

#ifdef CROP
     call ncio_write_vector (file_restart, 'cphase     ' , 'patch', landpatch, cphase               )
     call ncio_write_vector (file_restart, 'pdcorn     ' , 'patch', landpatch, pdcorn     , compress)
     call ncio_write_vector (file_restart, 'pdswheat   ' , 'patch', landpatch, pdswheat   , compress)
     call ncio_write_vector (file_restart, 'pdwwheat   ' , 'patch', landpatch, pdwwheat   , compress)
     call ncio_write_vector (file_restart, 'pdsoybean  ' , 'patch', landpatch, pdsoybean  , compress)
     call ncio_write_vector (file_restart, 'pdcotton   ' , 'patch', landpatch, pdcotton   , compress)
     call ncio_write_vector (file_restart, 'pdrice1    ' , 'patch', landpatch, pdrice1    , compress)
     call ncio_write_vector (file_restart, 'pdrice2    ' , 'patch', landpatch, pdrice2    , compress)
     call ncio_write_vector (file_restart, 'pdsugarcane' , 'patch', landpatch, pdsugarcane, compress)
     call ncio_write_vector (file_restart, 'fertnitro_corn     ' , 'patch', landpatch, fertnitro_corn     , compress)
     call ncio_write_vector (file_restart, 'fertnitro_swheat   ' , 'patch', landpatch, fertnitro_swheat   , compress)
     call ncio_write_vector (file_restart, 'fertnitro_wwheat   ' , 'patch', landpatch, fertnitro_wwheat   , compress)
     call ncio_write_vector (file_restart, 'fertnitro_soybean  ' , 'patch', landpatch, fertnitro_soybean  , compress)
     call ncio_write_vector (file_restart, 'fertnitro_cotton   ' , 'patch', landpatch, fertnitro_cotton   , compress)
     call ncio_write_vector (file_restart, 'fertnitro_rice1    ' , 'patch', landpatch, fertnitro_rice1    , compress)
     call ncio_write_vector (file_restart, 'fertnitro_rice2    ' , 'patch', landpatch, fertnitro_rice1    , compress)
     call ncio_write_vector (file_restart, 'fertnitro_sugarcane' , 'patch', landpatch, fertnitro_sugarcane, compress)
#endif

  end subroutine WRITE_BGCTimeVars

  !---------------------------------------
  SUBROUTINE READ_BGCTimeVars (file_restart)

     !=======================================================================
     ! Original version: Yongjiu Dai, September 15, 1999, 03/2014
     !=======================================================================

     use mod_namelist
     use spmd_task
     use ncio_vector
#ifdef CLMDEBUG 
   USE mod_colm_debug
#endif
     USE mod_landpatch
     USE GlobalVars

     IMPLICIT NONE

     character(LEN=*), intent(in) :: file_restart

! bgc variables
     call ncio_read_vector (file_restart, 'totlitc              ', landpatch, totlitc              )
     call ncio_read_vector (file_restart, 'totvegc              ', landpatch, totvegc              )
     call ncio_read_vector (file_restart, 'totsomc              ', landpatch, totsomc              )
     call ncio_read_vector (file_restart, 'totcwdc              ', landpatch, totcwdc              )
     call ncio_read_vector (file_restart, 'totcolc              ', landpatch, totcolc              )
     call ncio_read_vector (file_restart, 'totlitn              ', landpatch, totlitn              )
     call ncio_read_vector (file_restart, 'totvegn              ', landpatch, totvegn              )
     call ncio_read_vector (file_restart, 'totsomn              ', landpatch, totsomn              )
     call ncio_read_vector (file_restart, 'totcwdn              ', landpatch, totcwdn              )
     call ncio_read_vector (file_restart, 'totcoln              ', landpatch, totcoln              )
       
     call ncio_read_vector (file_restart, 'sminn                ', landpatch, sminn                )
     call ncio_read_vector (file_restart, 'ndep                 ', landpatch, ndep                 )

     call ncio_read_vector (file_restart, 'decomp_cpools_vr     ',   nl_soil, ndecomp_pools, landpatch, decomp_cpools_vr)
     call ncio_read_vector (file_restart, 'ctrunc_vr            ',   nl_soil, landpatch, ctrunc_vr            )

     call ncio_read_vector (file_restart, 'altmax               ', landpatch, altmax               )
     call ncio_read_vector (file_restart, 'altmax_lastyear      ', landpatch, altmax_lastyear      )
     call ncio_read_vector (file_restart, 'altmax_lastyear_indx ', landpatch, altmax_lastyear_indx )

     call ncio_read_vector (file_restart, 'decomp_npools_vr     ',   nl_soil, ndecomp_pools, landpatch, decomp_npools_vr)
     call ncio_read_vector (file_restart, 'ntrunc_vr            ',   nl_soil, landpatch, ntrunc_vr            )
     call ncio_read_vector (file_restart, 'sminn_vr             ',   nl_soil, landpatch, sminn_vr             )
     call ncio_read_vector (file_restart, 'smin_no3_vr          ',   nl_soil, landpatch, smin_no3_vr          )
     call ncio_read_vector (file_restart, 'smin_nh4_vr          ',   nl_soil, landpatch, smin_nh4_vr          )
#ifdef NITRIF
     call ncio_read_vector (file_restart, 'tCONC_O2_UNSAT       ',   nl_soil, landpatch, tconc_o2_unsat         )
     call ncio_read_vector (file_restart, 'tO2_DECOMP_DEPTH_UNSAT',  nl_soil, landpatch, to2_decomp_depth_unsat )
#endif

     call ncio_read_vector (file_restart, 'prec10               ', landpatch, prec10               )
     call ncio_read_vector (file_restart, 'prec60               ', landpatch, prec60               )
     call ncio_read_vector (file_restart, 'prec365              ', landpatch, prec365              )
     call ncio_read_vector (file_restart, 'prec_today           ', landpatch, prec_today           )
     call ncio_read_vector (file_restart, 'prec_daily           ',       365, landpatch, prec_daily)
     call ncio_read_vector (file_restart, 'tsoi17               ', landpatch, tsoi17               )
     call ncio_read_vector (file_restart, 'rh30                 ', landpatch, rh30                 )
     call ncio_read_vector (file_restart, 'accumnstep           ', landpatch, accumnstep           )

#ifdef SASU
!---------------SASU variables-----------------------
     call ncio_read_vector (file_restart, 'decomp0_cpools_vr            ',   nl_soil, ndecomp_pools, landpatch, decomp0_cpools_vr, defval = 1._r8            )
     call ncio_read_vector (file_restart, 'I_met_c_vr_acc               ',   nl_soil, landpatch, I_met_c_vr_acc, defval = 0._r8               )
     call ncio_read_vector (file_restart, 'I_cel_c_vr_acc               ',   nl_soil, landpatch, I_cel_c_vr_acc, defval = 0._r8               )
     call ncio_read_vector (file_restart, 'I_lig_c_vr_acc               ',   nl_soil, landpatch, I_lig_c_vr_acc, defval = 0._r8               )
     call ncio_read_vector (file_restart, 'I_cwd_c_vr_acc               ',   nl_soil, landpatch, I_cwd_c_vr_acc, defval = 0._r8               )
     call ncio_read_vector (file_restart, 'AKX_met_to_soil1_c_vr_acc    ',   nl_soil, landpatch, AKX_met_to_soil1_c_vr_acc, defval = 0._r8    )
     call ncio_read_vector (file_restart, 'AKX_cel_to_soil1_c_vr_acc    ',   nl_soil, landpatch, AKX_cel_to_soil1_c_vr_acc, defval = 0._r8    )
     call ncio_read_vector (file_restart, 'AKX_lig_to_soil2_c_vr_acc    ',   nl_soil, landpatch, AKX_lig_to_soil2_c_vr_acc, defval = 0._r8    )
     call ncio_read_vector (file_restart, 'AKX_soil1_to_soil2_c_vr_acc  ',   nl_soil, landpatch, AKX_soil1_to_soil2_c_vr_acc, defval = 0._r8  )
     call ncio_read_vector (file_restart, 'AKX_cwd_to_cel_c_vr_acc      ',   nl_soil, landpatch, AKX_cwd_to_cel_c_vr_acc, defval = 0._r8      )
     call ncio_read_vector (file_restart, 'AKX_cwd_to_lig_c_vr_acc      ',   nl_soil, landpatch, AKX_cwd_to_lig_c_vr_acc, defval = 0._r8      )
     call ncio_read_vector (file_restart, 'AKX_soil1_to_soil3_c_vr_acc  ',   nl_soil, landpatch, AKX_soil1_to_soil3_c_vr_acc, defval = 0._r8  )
     call ncio_read_vector (file_restart, 'AKX_soil2_to_soil1_c_vr_acc  ',   nl_soil, landpatch, AKX_soil2_to_soil1_c_vr_acc, defval = 0._r8  )
     call ncio_read_vector (file_restart, 'AKX_soil2_to_soil3_c_vr_acc  ',   nl_soil, landpatch, AKX_soil2_to_soil3_c_vr_acc, defval = 0._r8  )
     call ncio_read_vector (file_restart, 'AKX_soil3_to_soil1_c_vr_acc  ',   nl_soil, landpatch, AKX_soil3_to_soil1_c_vr_acc, defval = 0._r8  )
     call ncio_read_vector (file_restart, 'AKX_met_exit_c_vr_acc        ',   nl_soil, landpatch, AKX_met_exit_c_vr_acc, defval = 0._r8        )
     call ncio_read_vector (file_restart, 'AKX_cel_exit_c_vr_acc        ',   nl_soil, landpatch, AKX_cel_exit_c_vr_acc, defval = 0._r8        )
     call ncio_read_vector (file_restart, 'AKX_lig_exit_c_vr_acc        ',   nl_soil, landpatch, AKX_lig_exit_c_vr_acc, defval = 0._r8        )
     call ncio_read_vector (file_restart, 'AKX_cwd_exit_c_vr_acc        ',   nl_soil, landpatch, AKX_cwd_exit_c_vr_acc, defval = 0._r8        )
     call ncio_read_vector (file_restart, 'AKX_soil1_exit_c_vr_acc      ',   nl_soil, landpatch, AKX_soil1_exit_c_vr_acc, defval = 0._r8      )
     call ncio_read_vector (file_restart, 'AKX_soil2_exit_c_vr_acc      ',   nl_soil, landpatch, AKX_soil2_exit_c_vr_acc, defval = 0._r8      )
     call ncio_read_vector (file_restart, 'AKX_soil3_exit_c_vr_acc      ',   nl_soil, landpatch, AKX_soil3_exit_c_vr_acc, defval = 0._r8      )

     call ncio_read_vector (file_restart, 'decomp0_npools_vr            ',   nl_soil, ndecomp_pools, landpatch, decomp0_npools_vr, defval = 1._r8)
     call ncio_read_vector (file_restart, 'I_met_n_vr_acc               ',   nl_soil, landpatch, I_met_n_vr_acc, defval = 0._r8               )
     call ncio_read_vector (file_restart, 'I_cel_n_vr_acc               ',   nl_soil, landpatch, I_cel_n_vr_acc, defval = 0._r8               )
     call ncio_read_vector (file_restart, 'I_lig_n_vr_acc               ',   nl_soil, landpatch, I_lig_n_vr_acc, defval = 0._r8               )
     call ncio_read_vector (file_restart, 'I_cwd_n_vr_acc               ',   nl_soil, landpatch, I_cwd_n_vr_acc, defval = 0._r8               )
     call ncio_read_vector (file_restart, 'AKX_met_to_soil1_n_vr_acc    ',   nl_soil, landpatch, AKX_met_to_soil1_n_vr_acc, defval = 0._r8    )
     call ncio_read_vector (file_restart, 'AKX_cel_to_soil1_n_vr_acc    ',   nl_soil, landpatch, AKX_cel_to_soil1_n_vr_acc, defval = 0._r8    )
     call ncio_read_vector (file_restart, 'AKX_lig_to_soil2_n_vr_acc    ',   nl_soil, landpatch, AKX_lig_to_soil2_n_vr_acc, defval = 0._r8    )
     call ncio_read_vector (file_restart, 'AKX_soil1_to_soil2_n_vr_acc  ',   nl_soil, landpatch, AKX_soil1_to_soil2_n_vr_acc, defval = 0._r8  )
     call ncio_read_vector (file_restart, 'AKX_cwd_to_cel_n_vr_acc      ',   nl_soil, landpatch, AKX_cwd_to_cel_n_vr_acc, defval = 0._r8      )
     call ncio_read_vector (file_restart, 'AKX_cwd_to_lig_n_vr_acc      ',   nl_soil, landpatch, AKX_cwd_to_lig_n_vr_acc, defval = 0._r8      )
     call ncio_read_vector (file_restart, 'AKX_soil1_to_soil3_n_vr_acc  ',   nl_soil, landpatch, AKX_soil1_to_soil3_n_vr_acc, defval = 0._r8  )
     call ncio_read_vector (file_restart, 'AKX_soil2_to_soil1_n_vr_acc  ',   nl_soil, landpatch, AKX_soil2_to_soil1_n_vr_acc, defval = 0._r8  )
     call ncio_read_vector (file_restart, 'AKX_soil2_to_soil3_n_vr_acc  ',   nl_soil, landpatch, AKX_soil2_to_soil3_n_vr_acc, defval = 0._r8  )
     call ncio_read_vector (file_restart, 'AKX_soil3_to_soil1_n_vr_acc  ',   nl_soil, landpatch, AKX_soil3_to_soil1_n_vr_acc, defval = 0._r8  )
     call ncio_read_vector (file_restart, 'AKX_met_exit_n_vr_acc        ',   nl_soil, landpatch, AKX_met_exit_n_vr_acc, defval = 0._r8        )
     call ncio_read_vector (file_restart, 'AKX_cel_exit_n_vr_acc        ',   nl_soil, landpatch, AKX_cel_exit_n_vr_acc, defval = 0._r8        )
     call ncio_read_vector (file_restart, 'AKX_lig_exit_n_vr_acc        ',   nl_soil, landpatch, AKX_lig_exit_n_vr_acc, defval = 0._r8        )
     call ncio_read_vector (file_restart, 'AKX_cwd_exit_n_vr_acc        ',   nl_soil, landpatch, AKX_cwd_exit_n_vr_acc, defval = 0._r8        )
     call ncio_read_vector (file_restart, 'AKX_soil1_exit_n_vr_acc      ',   nl_soil, landpatch, AKX_soil1_exit_n_vr_acc, defval = 0._r8      )
     call ncio_read_vector (file_restart, 'AKX_soil2_exit_n_vr_acc      ',   nl_soil, landpatch, AKX_soil2_exit_n_vr_acc, defval = 0._r8      )
     call ncio_read_vector (file_restart, 'AKX_soil3_exit_n_vr_acc      ',   nl_soil, landpatch, AKX_soil3_exit_n_vr_acc, defval = 0._r8      )

     call ncio_read_vector (file_restart, 'diagVX_c_vr_acc              ',   nl_soil, ndecomp_pools, landpatch, diagVX_c_vr_acc, defval = 0._r8              )
     call ncio_read_vector (file_restart, 'upperVX_c_vr_acc             ',   nl_soil, ndecomp_pools, landpatch, upperVX_c_vr_acc, defval = 0._r8             )
     call ncio_read_vector (file_restart, 'lowerVX_c_vr_acc             ',   nl_soil, ndecomp_pools, landpatch, lowerVX_c_vr_acc, defval = 0._r8             )
     call ncio_read_vector (file_restart, 'diagVX_n_vr_acc              ',   nl_soil, ndecomp_pools, landpatch, diagVX_n_vr_acc, defval = 0._r8              )
     call ncio_read_vector (file_restart, 'upperVX_n_vr_acc             ',   nl_soil, ndecomp_pools, landpatch, upperVX_n_vr_acc, defval = 0._r8             )
     call ncio_read_vector (file_restart, 'lowerVX_n_vr_acc             ',   nl_soil, ndecomp_pools, landpatch, lowerVX_n_vr_acc, defval = 0._r8             )

!----------------------------------------------------
#endif
     call ncio_read_vector (file_restart, 'skip_balance_check           ', landpatch, skip_balance_check           )
#ifdef CROP
     call ncio_read_vector (file_restart, 'cphase     ' , landpatch, cphase     )
     call ncio_read_vector (file_restart, 'pdcorn     ' , landpatch, pdcorn     )
     call ncio_read_vector (file_restart, 'pdswheat   ' , landpatch, pdswheat   )
     call ncio_read_vector (file_restart, 'pdwwheat   ' , landpatch, pdwwheat   )
     call ncio_read_vector (file_restart, 'pdsoybean  ' , landpatch, pdsoybean  )
     call ncio_read_vector (file_restart, 'pdcotton   ' , landpatch, pdcotton   )
     call ncio_read_vector (file_restart, 'pdrice1    ' , landpatch, pdrice1    )
     call ncio_read_vector (file_restart, 'pdrice2    ' , landpatch, pdrice2    )
     call ncio_read_vector (file_restart, 'pdsugarcane' , landpatch, pdsugarcane)
     call ncio_read_vector (file_restart, 'fertnitro_corn     ' , landpatch, fertnitro_corn     )
     call ncio_read_vector (file_restart, 'fertnitro_swheat   ' , landpatch, fertnitro_swheat   )
     call ncio_read_vector (file_restart, 'fertnitro_wwheat   ' , landpatch, fertnitro_wwheat   )
     call ncio_read_vector (file_restart, 'fertnitro_soybean  ' , landpatch, fertnitro_soybean  )
     call ncio_read_vector (file_restart, 'fertnitro_cotton   ' , landpatch, fertnitro_cotton   )
     call ncio_read_vector (file_restart, 'fertnitro_rice1    ' , landpatch, fertnitro_rice1    )
     call ncio_read_vector (file_restart, 'fertnitro_rice2    ' , landpatch, fertnitro_rice1    )
     call ncio_read_vector (file_restart, 'fertnitro_sugarcane' , landpatch, fertnitro_sugarcane)
#endif

#ifdef CLMDEBUG
     call check_BGCTimeVars
#endif
     
  end subroutine READ_BGCTimeVars

  !---------------------------------------
#ifdef CLMDEBUG
  SUBROUTINE check_BGCTimeVars ()

     use spmd_task
     use mod_colm_debug

     IMPLICIT NONE

! bgc variables
     call check_vector_data ('decomp_cpools_vr  ', decomp_cpools_vr  ) 
     call check_vector_data ('decomp_cpools     ', decomp_cpools     ) 
     call check_vector_data ('decomp_k          ', decomp_k          ) 
     call check_vector_data ('ctrunc_vr         ', ctrunc_vr         ) 
     call check_vector_data ('ctrunc_veg        ', ctrunc_veg        ) 
     call check_vector_data ('ctrunc_soil       ', ctrunc_soil       ) 

     call check_vector_data ('t_scalar          ', t_scalar          ) 
     call check_vector_data ('w_scalar          ', w_scalar          ) 
     call check_vector_data ('o_scalar          ', o_scalar          ) 
     call check_vector_data ('depth_scalar      ', depth_scalar      ) 

! Soil CN diffusion and advection
     call check_vector_data ('som_adv_coef             ', som_adv_coef             ) 
     call check_vector_data ('som_diffus_coef          ', som_diffus_coef          ) 

! Active Layer
     call check_vector_data ('altmax                   ', altmax                   ) 
     call check_vector_data ('altmax_lastyear          ', altmax_lastyear          ) 
     !call check_vector_data ('altmax_lastyear_indx     ', altmax_lastyear_indx     ) 

     call check_vector_data ('totlitc                  ', totlitc                  ) 
     call check_vector_data ('totvegc                  ', totvegc                  ) 
     call check_vector_data ('totsomc                  ', totsomc                  ) 
     call check_vector_data ('totcwdc                  ', totcwdc                  ) 
     call check_vector_data ('totcolc                  ', totcolc                  ) 
     call check_vector_data ('col_begcb                ', col_begcb                ) 
     call check_vector_data ('col_endcb                ', col_endcb                ) 
     call check_vector_data ('col_vegbegcb             ', col_vegbegcb             ) 
     call check_vector_data ('col_vegendcb             ', col_vegendcb             ) 
     call check_vector_data ('col_soilbegcb            ', col_soilbegcb            ) 
     call check_vector_data ('col_soilendcb            ', col_soilendcb            ) 

     call check_vector_data ('totlitn                  ', totlitn                  ) 
     call check_vector_data ('totvegn                  ', totvegn                  ) 
     call check_vector_data ('totsomn                  ', totsomn                  ) 
     call check_vector_data ('totcwdn                  ', totcwdn                  ) 
     call check_vector_data ('totcoln                  ', totcoln                  ) 
     call check_vector_data ('col_begnb                ', col_begnb                ) 
     call check_vector_data ('col_endnb                ', col_endnb                ) 
     call check_vector_data ('col_vegbegnb             ', col_vegbegnb             ) 
     call check_vector_data ('col_vegendnb             ', col_vegendnb             ) 
     call check_vector_data ('col_soilbegnb            ', col_soilbegnb            ) 
     call check_vector_data ('col_soilendnb            ', col_soilendnb            ) 
     call check_vector_data ('col_sminnbegnb           ', col_sminnbegnb           ) 
     call check_vector_data ('col_sminnendnb           ', col_sminnendnb           ) 

     call check_vector_data ('leafc                    ', leafc                    ) 
     call check_vector_data ('leafc_storage            ', leafc_storage            ) 
     call check_vector_data ('leafc_xfer               ', leafc_xfer               ) 
     call check_vector_data ('frootc                   ', frootc                   ) 
     call check_vector_data ('frootc_storage           ', frootc_storage           ) 
     call check_vector_data ('frootc_xfer              ', frootc_xfer              ) 
     call check_vector_data ('livestemc                ', livestemc                ) 
     call check_vector_data ('livestemc_storage        ', livestemc_storage        ) 
     call check_vector_data ('livestemc_xfer           ', livestemc_xfer           ) 
     call check_vector_data ('deadstemc                ', deadstemc                ) 
     call check_vector_data ('deadstemc_storage        ', deadstemc_storage        ) 
     call check_vector_data ('deadstemc_xfer           ', deadstemc_xfer           ) 
     call check_vector_data ('livecrootc               ', livecrootc               ) 
     call check_vector_data ('livecrootc_storage       ', livecrootc_storage       ) 
     call check_vector_data ('livecrootc_xfer          ', livecrootc_xfer          ) 
     call check_vector_data ('deadcrootc               ', deadcrootc               ) 
     call check_vector_data ('deadcrootc_storage       ', deadcrootc_storage       ) 
     call check_vector_data ('deadcrootc_xfer          ', deadcrootc_xfer          ) 
     call check_vector_data ('grainc                   ', grainc                   ) 
     call check_vector_data ('grainc_storage           ', grainc_storage           ) 
     call check_vector_data ('grainc_xfer              ', grainc_xfer              ) 
     call check_vector_data ('xsmrpool                 ', xsmrpool                 ) 
     call check_vector_data ('downreg                  ', downreg                  ) 
     call check_vector_data ('cropprod1c               ', cropprod1c               ) 
     call check_vector_data ('cropseedc_deficit        ', cropseedc_deficit        ) 

     call check_vector_data ('leafn                    ', leafn                    ) 
     call check_vector_data ('leafn_storage            ', leafn_storage            ) 
     call check_vector_data ('leafn_xfer               ', leafn_xfer               ) 
     call check_vector_data ('frootn                   ', frootn                   ) 
     call check_vector_data ('frootn_storage           ', frootn_storage           ) 
     call check_vector_data ('frootn_xfer              ', frootn_xfer              ) 
     call check_vector_data ('livestemn                ', livestemn                ) 
     call check_vector_data ('livestemn_storage        ', livestemn_storage        ) 
     call check_vector_data ('livestemn_xfer           ', livestemn_xfer           ) 
     call check_vector_data ('deadstemn                ', deadstemn                ) 
     call check_vector_data ('deadstemn_storage        ', deadstemn_storage        ) 
     call check_vector_data ('deadstemn_xfer           ', deadstemn_xfer           ) 
     call check_vector_data ('livecrootn               ', livecrootn               ) 
     call check_vector_data ('livecrootn_storage       ', livecrootn_storage       ) 
     call check_vector_data ('livecrootn_xfer          ', livecrootn_xfer          ) 
     call check_vector_data ('deadcrootn               ', deadcrootn               ) 
     call check_vector_data ('deadcrootn_storage       ', deadcrootn_storage       ) 
     call check_vector_data ('deadcrootn_xfer          ', deadcrootn_xfer          ) 
     call check_vector_data ('grainn                   ', grainn                   ) 
     call check_vector_data ('grainn_storage           ', grainn_storage           ) 
     call check_vector_data ('grainn_xfer              ', grainn_xfer              ) 
     call check_vector_data ('retransn                 ', retransn                 ) 

     call check_vector_data ('decomp_npools_vr         ', decomp_npools_vr         ) 
     call check_vector_data ('decomp_npools            ', decomp_npools            ) 
     call check_vector_data ('ntrunc_vr                ', ntrunc_vr                ) 
     call check_vector_data ('ntrunc_veg               ', ntrunc_veg               ) 
     call check_vector_data ('ntrunc_soil              ', ntrunc_soil              ) 

     call check_vector_data ('sminn_vr                 ', sminn_vr                 ) 
     call check_vector_data ('smin_no3_vr              ', smin_no3_vr              ) 
     call check_vector_data ('smin_nh4_vr              ', smin_nh4_vr              ) 

#ifdef NITRIF
     call check_vector_data ('tCONC_O2_UNSAT           ', tconc_o2_unsat )
     call check_vector_data ('tO2_DECOMP_DEPTH_UNSAT   ', to2_decomp_depth_unsat   )
#endif

     call check_vector_data ('sminn                    ', sminn                    ) 
     call check_vector_data ('ndep                     ', ndep                     ) 

     call check_vector_data ('ndep_prof                ', ndep_prof                ) 
     call check_vector_data ('nfixation_prof           ', nfixation_prof           ) 

     call check_vector_data ('cn_decomp_pools          ', cn_decomp_pools          ) 
     call check_vector_data ('fpi_vr                   ', fpi_vr                   ) 
     call check_vector_data ('fpi                      ', fpi                      ) 
     call check_vector_data ('fpg                      ', fpg                      ) 

     call check_vector_data ('cropf                    ', cropf                    ) 
     call check_vector_data ('lfwt                     ', lfwt                     ) 
     call check_vector_data ('fuelc                    ', fuelc                    ) 
     call check_vector_data ('fuelc_crop               ', fuelc_crop               ) 
     call check_vector_data ('fsr                      ', fsr                      ) 
     call check_vector_data ('fd                       ', fd                       ) 
     call check_vector_data ('rootc                    ', rootc                    ) 
     call check_vector_data ('lgdp                     ', lgdp                     ) 
     call check_vector_data ('lgdp1                    ', lgdp1                    ) 
     call check_vector_data ('lpop                     ', lpop                     ) 
     call check_vector_data ('wtlf                     ', wtlf                     ) 
     call check_vector_data ('trotr1                   ', trotr1                   ) 
     call check_vector_data ('trotr2                   ', trotr2                   ) 
     call check_vector_data ('hdm_lf                   ', hdm_lf                   ) 
     call check_vector_data ('lnfm                     ', lnfm                     ) 
     call check_vector_data ('baf_crop                 ', baf_crop                 ) 
     call check_vector_data ('baf_peatf                ', baf_peatf                ) 
     call check_vector_data ('farea_burned             ', farea_burned             ) 
     call check_vector_data ('nfire                    ', nfire                    ) 
     call check_vector_data ('fsat                     ', fsat                     ) 
     call check_vector_data ('prec10                   ', prec10                   ) 
     call check_vector_data ('prec60                   ', prec60                   ) 
     call check_vector_data ('prec365                  ', prec365                  ) 
     call check_vector_data ('prec_today               ', prec_today               ) 
     call check_vector_data ('prec_daily               ', prec_daily               ) 
     call check_vector_data ('wf2                      ', wf2                      ) 
     call check_vector_data ('tsoi17                   ', tsoi17                   ) 
     call check_vector_data ('rh30                     ', rh30                     ) 
     call check_vector_data ('accumnstep               ', accumnstep               ) 

     call check_vector_data ('dayl                     ', dayl                     ) 
     call check_vector_data ('prev_dayl                ', prev_dayl                ) 

#ifdef SASU
!--------------SASU variables---------------------------
     call check_vector_data ('decomp0_cpools_vr           ', decomp0_cpools_vr           ) 
     call check_vector_data ('I_met_c_vr_acc              ', I_met_c_vr_acc              ) 
     call check_vector_data ('I_cel_c_vr_acc              ', I_cel_c_vr_acc              ) 
     call check_vector_data ('I_lig_c_vr_acc              ', I_lig_c_vr_acc              ) 
     call check_vector_data ('I_cwd_c_vr_acc              ', I_cwd_c_vr_acc              ) 
     call check_vector_data ('AKX_met_to_soil1_c_vr_acc   ', AKX_met_to_soil1_c_vr_acc   ) 
     call check_vector_data ('AKX_cel_to_soil1_c_vr_acc   ', AKX_cel_to_soil1_c_vr_acc   ) 
     call check_vector_data ('AKX_lig_to_soil2_c_vr_acc   ', AKX_lig_to_soil2_c_vr_acc   ) 
     call check_vector_data ('AKX_soil1_to_soil2_c_vr_acc ', AKX_soil1_to_soil2_c_vr_acc ) 
     call check_vector_data ('AKX_cwd_to_cel_c_vr_acc     ', AKX_cwd_to_cel_c_vr_acc     ) 
     call check_vector_data ('AKX_cwd_to_lig_c_vr_acc     ', AKX_cwd_to_lig_c_vr_acc     ) 
     call check_vector_data ('AKX_soil1_to_soil3_c_vr_acc ', AKX_soil1_to_soil3_c_vr_acc ) 
     call check_vector_data ('AKX_soil2_to_soil1_c_vr_acc ', AKX_soil2_to_soil1_c_vr_acc ) 
     call check_vector_data ('AKX_soil2_to_soil3_c_vr_acc ', AKX_soil2_to_soil3_c_vr_acc ) 
     call check_vector_data ('AKX_soil3_to_soil1_c_vr_acc ', AKX_soil3_to_soil1_c_vr_acc ) 
     call check_vector_data ('AKX_met_exit_c_vr_acc       ', AKX_met_exit_c_vr_acc       ) 
     call check_vector_data ('AKX_cel_exit_c_vr_acc       ', AKX_cel_exit_c_vr_acc       ) 
     call check_vector_data ('AKX_lig_exit_c_vr_acc       ', AKX_lig_exit_c_vr_acc       ) 
     call check_vector_data ('AKX_cwd_exit_c_vr_acc       ', AKX_cwd_exit_c_vr_acc       ) 
     call check_vector_data ('AKX_soil1_exit_c_vr_acc     ', AKX_soil1_exit_c_vr_acc     ) 
     call check_vector_data ('AKX_soil2_exit_c_vr_acc     ', AKX_soil2_exit_c_vr_acc     ) 
     call check_vector_data ('AKX_soil3_exit_c_vr_acc     ', AKX_soil3_exit_c_vr_acc     ) 

     call check_vector_data ('decomp0_npools_vr           ', decomp0_npools_vr           ) 
     call check_vector_data ('I_met_n_vr_acc              ', I_met_n_vr_acc              ) 
     call check_vector_data ('I_cel_n_vr_acc              ', I_cel_n_vr_acc              ) 
     call check_vector_data ('I_lig_n_vr_acc              ', I_lig_n_vr_acc              ) 
     call check_vector_data ('I_cwd_n_vr_acc              ', I_cwd_n_vr_acc              ) 
     call check_vector_data ('AKX_met_to_soil1_n_vr_acc   ', AKX_met_to_soil1_n_vr_acc   ) 
     call check_vector_data ('AKX_cel_to_soil1_n_vr_acc   ', AKX_cel_to_soil1_n_vr_acc   ) 
     call check_vector_data ('AKX_lig_to_soil2_n_vr_acc   ', AKX_lig_to_soil2_n_vr_acc   ) 
     call check_vector_data ('AKX_soil1_to_soil2_n_vr_acc ', AKX_soil1_to_soil2_n_vr_acc ) 
     call check_vector_data ('AKX_cwd_to_cel_n_vr_acc     ', AKX_cwd_to_cel_n_vr_acc     ) 
     call check_vector_data ('AKX_cwd_to_lig_n_vr_acc     ', AKX_cwd_to_lig_n_vr_acc     ) 
     call check_vector_data ('AKX_soil1_to_soil3_n_vr_acc ', AKX_soil1_to_soil3_n_vr_acc ) 
     call check_vector_data ('AKX_soil2_to_soil1_n_vr_acc ', AKX_soil2_to_soil1_n_vr_acc ) 
     call check_vector_data ('AKX_soil2_to_soil3_n_vr_acc ', AKX_soil2_to_soil3_n_vr_acc ) 
     call check_vector_data ('AKX_soil3_to_soil1_n_vr_acc ', AKX_soil3_to_soil1_n_vr_acc ) 
     call check_vector_data ('AKX_met_exit_n_vr_acc       ', AKX_met_exit_n_vr_acc       ) 
     call check_vector_data ('AKX_cel_exit_n_vr_acc       ', AKX_cel_exit_n_vr_acc       ) 
     call check_vector_data ('AKX_lig_exit_n_vr_acc       ', AKX_lig_exit_n_vr_acc       ) 
     call check_vector_data ('AKX_cwd_exit_n_vr_acc       ', AKX_cwd_exit_n_vr_acc       ) 
     call check_vector_data ('AKX_soil1_exit_n_vr_acc     ', AKX_soil1_exit_n_vr_acc     ) 
     call check_vector_data ('AKX_soil2_exit_n_vr_acc     ', AKX_soil2_exit_n_vr_acc     ) 
     call check_vector_data ('AKX_soil3_exit_n_vr_acc     ', AKX_soil3_exit_n_vr_acc     ) 

     call check_vector_data ('diagVX_c_vr_acc             ', diagVX_c_vr_acc             ) 
     call check_vector_data ('upperVX_c_vr_acc            ', upperVX_c_vr_acc            ) 
     call check_vector_data ('lowerVX_c_vr_acc            ', lowerVX_c_vr_acc            ) 
     call check_vector_data ('diagVX_n_vr_acc             ', diagVX_n_vr_acc             ) 
     call check_vector_data ('upperVX_n_vr_acc            ', upperVX_n_vr_acc            ) 
     call check_vector_data ('lowerVX_n_vr_acc            ', lowerVX_n_vr_acc            ) 
!     call check_vector_data ('skip_balance_check          ', skip_balance_check          ) 
!------------------------------------------------------
#endif
#ifdef CROP
     call check_vector_data ('cphase     ' , cphase     ) 
     call check_vector_data ('vf         ' , vf         )
     call check_vector_data ('hui        ' , hui        )
     call check_vector_data ('huiswheat  ' , huiswheat  )
     call check_vector_data ('gddplant   ' , gddplant   )
     call check_vector_data ('gddmaturity' , gddmaturity)
     call check_vector_data ('pdcorn     ' , pdcorn     )
     call check_vector_data ('pdswheat   ' , pdswheat   )
     call check_vector_data ('pdwwheat   ' , pdwwheat   )
     call check_vector_data ('pdsoybean  ' , pdsoybean  )
     call check_vector_data ('pdcotton   ' , pdcotton   )
     call check_vector_data ('pdrice1    ' , pdrice1    )
     call check_vector_data ('pdrice2    ' , pdrice2    )
     call check_vector_data ('plantdate  ' , plantdate  )
     call check_vector_data ('pdsugarcane' , pdsugarcane)
     call check_vector_data ('fertnitro_corn     ' , fertnitro_corn     )
     call check_vector_data ('fertnitro_swheat   ' , fertnitro_swheat   )
     call check_vector_data ('fertnitro_wwheat   ' , fertnitro_wwheat   )
     call check_vector_data ('fertnitro_soybean  ' , fertnitro_soybean  )
     call check_vector_data ('fertnitro_cotton   ' , fertnitro_cotton   )
     call check_vector_data ('fertnitro_rice1    ' , fertnitro_rice1    )
     call check_vector_data ('fertnitro_rice2    ' , fertnitro_rice1    )
     call check_vector_data ('fertnitro_sugarcane' , fertnitro_sugarcane)
#endif
     call check_vector_data ('lag_npp    ' , lag_npp    )

  end subroutine check_BGCTimeVars
#endif

#endif
END MODULE MOD_BGCTimeVars
! ------ EOP --------------
